<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <title></title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background-color: gray;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col-12 bg-secondary rounded d-flex align-items-center justify-content-between p-2">
                
                <div class="float-end">
                    <span class="me-3">Felhasználó neve</span>
                    <span>Belépve (30:20)</span>
                </div>

                <nav class="navbar navbar-dark">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse position-absolute top-100 end-0 bg-secondary rounded p-3" id="navbarMenu">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link text-white" href="#">Főoldal</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="#">Rólunk</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="#">Kapcsolat</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>

        <div class="row">
            <div class="col-6">


                <div class="pt-5">
                    <input type="text" oninput="//KeresesKezdese()" class="form-control email"
                        style="height: 45px; color: black;" placeholder="Keresés..." id="kereso" name="kereso">
                </div>

                <button onclick="keres()">Keresés</button>

                <div id="eredmeny" class="eredmeny"></div>


            </div>

            <div class="col-6">
                <div id="lejatszo" class="lejatszo"></div>
            </div>
        </div>
    </div>


    <script>


        let player;
        let isPlaying = false;

        function hangSzabalyzo(hangero) {
            if (player && player.setVolume) {
                player.setVolume(hangero);
            }
        }

        function inditas() {
            if (isPlaying) {
                player.pauseVideo();
            }
            if (!isPlaying) {
                player.playVideo();
            }

            isPlaying = !isPlaying;
        }
        /*
                    function embedVideo(id) {
                        document.getElementById("lejatszo").innerHTML = `
                <iframe id="ytFrame" width="600" height="340" src="https://www.youtube.com/embed/${id}?enablejsapi=1" frameborder="0" allow="autoplay"></iframe>
            `;
                        setTimeout(() => {
                            player = new YT.Player('ytFrame');
                        }, 500);
                    }
        */
        function slider() {
            let seekSlider = document.getElementById("seekSlider");
            seekSlider.addEventListener("input", () => {
                let seekto = player.getDuration() * (seekSlider.value / 1000);
                player.seekTo(seekto, true);
            });

            if (player && player.getDuration) {
                let ujpozicio = player.getCurrentTime() * (1000 / player.getDuration());
                //console.log(player.getCurrentTime());
                

                seekSlider.value = ujpozicio;
            };

            requestAnimationFrame(slider);

        }


        function ido()
                {
                    let ido = player.getCurrentTime();
                    return ido;
                    console.log(ido);
                }

    console.log(player.getCurrentTime());

        function embedVideo(id) {
            document.getElementById("lejatszo").innerHTML = `<div id="ytFrame"></div> <br>
                                                            <label>Hangerő: </label>
                                                            <input id="volumeSlider" type="range" min="0" max="100" value="50" oninput="hangSzabalyzo(this.value)"><br>
                                                            
                                                            <input type="range" id="seekSlider" min="0" max="1000" value="0" style="width: 100%;">
                                                            <div class="d-flex justify-content-between">
                                                                <span></span>
                                                                <span></span>

                                                            </div>
                                                            <button onclick="inditas()">Lejátszás</button>`;
            player = new YT.Player('ytFrame', {
                width: 600,
                height: 340,
                videoId: id,
                events: {
                    onReady: () => {
                        player.setVolume(
                            document.getElementById("volumeSlider").value
                        );
                        slider();
                        
                    }
                }
            });
        }

        function keres() {
            const kereso = document.getElementById("kereso").value;
            const eredmeny = document.getElementById("eredmeny");

            if (kereso.length < 3) {
                eredmeny.innerHTML = "<p>Írj be legalább 3 karaktert...</p>";
                return;
            }

            eredmeny.innerHTML = "<p>Keresés folyamatban...</p>";

            const apikulcs = "AIzaSyAvqcZuWfXHENDGZOhjSKoKyaZe4xGtTVM";
            const URL = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=3&q=${encodeURIComponent(kereso)}&key=${apikulcs}`;

            function lekerVideok(vissza) {
                fetch(URL)
                    .then(valasz => valasz.json())
                    .then(adatok => {
                        console.log(adatok);
                        const videok = [];

                        adatok.items.forEach(item => {
                            videok.push({
                                videoId: item.id.videoId,
                                title: item.snippet.title,
                                img: item.snippet.thumbnails.medium.url
                            });
                        });

                        vissza(videok);
                    });
            }

            /*
                        lekerVideok(videok => {
                            console.log(videok);
                        });
            */

            lekerVideok(function (videok) {

                eredmeny.innerHTML = "";

                console.log(videok[0].title);

                if (!videok.length) {
                    eredmeny.innerHTML = "<p>Nincs találat vagy hiba történt.</p>";
                    return;
                }
                //console.log(videok);


                for (let i = 0; i < videok.length; i++) {
                    let keret = document.createElement("div");
                    //console.log("asd");
                    keret.classList.add("container");

                    let talalat = document.createElement("div");

                    //talalat.className = "video";

                    talalat.innerHTML = `
                    <div class="row mb-3 p-2 bg-light rounded video">
                        <div class="col-4">
                            <img src="${videok[i].img}" class=" img-fluid"/>
                        </div>
                        <div class="col-8">
                            <h3>${videok[i].title}</h3>
                        </div>
                    </div>
                    `;

                    //console.log(videok[i].videoId);
                    //console.log(typeof videok[i].videoId);
                    talalat.onclick = () => embedVideo(videok[i].videoId);

                    keret.appendChild(talalat);
                    eredmeny.appendChild(keret);
                }
                //linkList.innerHTML = "";
                //linkList.innerHTML += `<p><a href=\"https://www.youtube.com/watch?v=${videoId}\" target=\"_blank\">${title}</a></p>`;

            });
        }

        document.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                keres();
            }
        });

    </script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</body>

</html>